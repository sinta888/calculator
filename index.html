<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NTU Tuition Fee Calculator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    margin: 0;
    padding: 40px;
    background: #f5f5f5;
  }
  .container {
    max-width: 700px;
    width: 100%;
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    text-align: center;
  }
  h1 { margin-bottom: 20px; color:#181c62; }
  .step { display: none; text-align: left; margin-top: 20px; }
  .active { display: block; }
  .button-container { text-align: center; margin-top: 20px; }
  button {
    padding: 10px 20px;
    margin: 10px 10px 0 0;
    background-color: #181c62;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
  }
  button:hover { opacity: 0.9; }
  label { display:block; margin: 8px 0; }
  .result {
    margin-top: 30px;
    padding: 20px;
    border: 1px solid #ccc;
    background: #f9f9f9;
    font-family: monospace;
  }
  .disclaimer { font-size: 12px; color: gray; margin-top: 15px; }
  a { color: #181c62; text-decoration: underline; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { padding: 6px; }
  th { text-align: left; border-bottom: 1px solid #ccc; }
  td:last-child { text-align: right; }
</style>
</head>
<body>
<div class="container">
<h1>NTU Tuition Fee Calculator</h1>

<!-- Step 0: Programme selection -->
<div class="step active" id="step0">
  <h3>Select your programme:</h3>
  <label><input type="radio" name="programme" value="msc"> MSc (Coursework)</label>
  <label><input type="radio" name="programme" value="flexi"> Flexi Masters</label>
  <div class="button-container">
    <button onclick="nextStep('step0')">Next</button>
  </div>
</div>

<!-- Combined step for MSc -->
<div class="step" id="mscStep">
  <h3>MSc Options</h3>
  <label>Status:<br>
    <input type="radio" name="mscStatus" value="intl"> International Student
    <input type="radio" name="mscStatus" value="scspr"> SC/PR
  </label>
  <label>Financial Aid (SC/PR only):<br>
    <input type="checkbox" id="mscAid"> Up to S$15,000 (<a href="https://www.ntu.edu.sg/admissions/graduate/financialmatters/ntupgi#Content_C017_Col00" target="_blank">More info</a>)
  </label>
  <label>NTU Alumni:<br>
    <input type="checkbox" id="mscAlumni"> Yes (10% rebate)
  </label>
  <div class="button-container">
    <button onclick="prevStep('mscStep')">Back</button>
    <button onclick="showResult()">Calculate</button>
  </div>
</div>

<!-- Combined step for Flexi -->
<div class="step" id="flexiStep">
  <h3>Flexi Masters Options</h3>
  <label>Status:<br>
    <input type="radio" name="flexiStatus" value="intl"> International Student
    <input type="radio" name="flexiStatus" value="scspr"> SC/PR
  </label>
  <label>Funding Type:<br>
    <input type="radio" name="flexiPay" value="self"> Self-funded
    <input type="radio" name="flexiPay" value="company"> Company-sponsored
  </label>
  <label>Subsidy Scheme:<br>
    <input type="radio" name="flexiFunding" value="ssg70"> SSG up to 70% (Payable: S$8,423.52)<br>
    <input type="radio" name="flexiFunding" value="mces"> MCES â‰¥40yo (Payable: S$3,271.52)<br>
    <input type="radio" name="flexiFunding" value="etss"> ETSS (Company only) (Payable: S$3,271.52) <a href="https://www.skillsfuture.gov.sg/initiatives/employers/enhanced-training-support-for-smes" target="_blank">Check eligibility</a>
  </label>
  <label>NTU Alumni:<br>
    <input type="checkbox" id="flexiAlumni"> Yes (Course credits S$1,600)
  </label>
  <label id="sfBlock">SkillsFuture Credits (SC/PR only):<br>
    <input type="number" id="sfAmount" min="0" step="1" placeholder="Enter amount"> 
  </label>
  <div class="button-container">
    <button onclick="prevStep('flexiStep')">Back</button>
    <button onclick="showResult()">Calculate</button>
  </div>
</div>

<div class="step" id="stepResult">
  <h3>Your Estimated Tuition Fee</h3>
  <div class="result" id="tuitionResult"></div>
  <div class="disclaimer">*This is an estimated calculation. Actual fees may vary based on school policies, GST, funding eligibility, and other considerations.</div>
  <div class="button-container">
    <button onclick="restart()">Start Over</button>
  </div>
</div>

<script>
let tuitionMScBase = 56156.80;
let tuitionFlexiBase = 28078.40;

function nextStep(stepId) {
  let checked = document.querySelector(`#${stepId} input[type='radio']:checked`);
  if (!checked) { alert("Please make a selection to proceed."); return; }
  document.getElementById(stepId).classList.remove("active");
  if (checked.value === "msc") document.getElementById("mscStep").classList.add("active");
  else document.getElementById("flexiStep").classList.add("active");
}

function prevStep(stepId) {
  document.getElementById(stepId).classList.remove("active");
  document.getElementById("step0").classList.add("active");
}

function restart() {
  document.querySelectorAll(".step").forEach(s => s.classList.remove("active"));
  document.getElementById("step0").classList.add("active");
  document.getElementById("tuitionResult").innerHTML = "";
}

function showResult() {
  document.querySelectorAll(".step").forEach(s => s.classList.remove("active"));
  document.getElementById("stepResult").classList.add("active");
  calcTuition();
}

function calcTuition() {
  let programme = document.querySelector("input[name='programme']:checked").value;
  let breakdown = [];
  let payable = 0;
  let base = 0;

  if (programme === "msc") {
    base = tuitionMScBase;
    payable = base;
    breakdown.push(["Base Tuition", `S$${base.toFixed(2)}`]);

    let status = document.querySelector("input[name='mscStatus']:checked").value;
    if (status === "scspr") {
      payable -= 5000;
      breakdown.push(["Subsidy (SC/PR)", "- S$5000.00"]);
      if (document.getElementById("mscAid").checked) {
        payable -= 15000;
        breakdown.push(["Financial Aid", "- S$15000.00"]);
      }
    }
    if (document.getElementById("mscAlumni").checked) {
      let rebate = payable * 0.1;
      payable -= rebate;
      breakdown.push(["Alumni Rebate (10%)", `- S$${rebate.toFixed(2)}`]);
    }
  }

  else if (programme === "flexi") {
    base = tuitionFlexiBase;
    payable = base;
    breakdown.push(["Base Tuition", `S$${base.toFixed(2)}`]);

    let status = document.querySelector("input[name='flexiStatus']:checked").value;
    let pay = document.querySelector("input[name='flexiPay']:checked").value;
    let funding = document.querySelector("input[name='flexiFunding']:checked");

    if (pay === "self" && status === "scspr") {
      if (funding) {
        if (funding.value === "ssg70") payable = 8423.52;
        else if (funding.value === "mces") payable = 3271.52;
      }
      if (document.getElementById("flexiAlumni").checked) {
        payable -= 1600;
        breakdown.push(["Alumni Credits", "- S$1600.00"]);
      }
      let sfAmount = parseFloat(document.getElementById("sfAmount").value) || 0;
      if (sfAmount > 0) {
        payable -= sfAmount;
        breakdown.push(["SkillsFuture Credits", `- S$${sfAmount.toFixed(2)}`]);
      }
    }

    if (pay === "company" && funding && funding.value === "etss") {
      payable = 3271.52;
      breakdown.push(["ETSS Subsidy", "- Applied (SME only)"]);
    }

    // Hide SkillsFuture if intl
    document.getElementById("sfBlock").style.display = (status === "intl") ? "none" : "block";
  }

  if (payable < 0) payable = 0;

  // Build table HTML
  let table = `<table><tr><th>Item</th><th>Amount</th></tr>`;
  breakdown.forEach(([label, val]) => {
    table += `<tr><td>${label}</td><td>${val}</td></tr>`;
  });
  table += `<tr><td><strong>Estimated Tuition Payable</strong></td><td><strong>S$${payable.toFixed(2)}</strong></td></tr>`;
  table += `</table>`;

  document.getElementById("tuitionResult").innerHTML = table;
}
</script>
</div>
</body>
</html>
